<!DOCTYPE html>
<html>

<head>
    <title>TestCSV</title>
</head>
<h1>Log file analysis</h1>


<body>
    <input type="file" id="fileInput">
    <button type="button" onclick="loadFile()">Load file</button>
    <button type="button" onclick="parseCSV()">Analyze</button>
    <script src="utils.js"></script>
    <script src="analysis-tools.js"></script>
    <script src="PapaParse-4.1.2/papaparse.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
</body>
<form action="#" onsubmit="parseCSV(this); return false">
    <table>
        <tr>
            <th>Teams</th>
            <th>Levels</th>
            <th>Actions</th>
        </tr>
        <tr>
            <td>
                <input type="checkbox" name="team" value="All" checked> All teams
                <br>
                <input type="checkbox" name="team" value="Weather"> Weather
                <br>
                <input type="checkbox" name="team" value="Pets"> Pets
                <br>
                <input type="checkbox" name="team" value="Dogs"> Dogs
                <br>
            </td>
            <td>
                <input type="checkbox" name="level" value="All" checked> All levels
                <br>
                <input type="checkbox" name="level" value="A"> A
                <br>
                <input type="checkbox" name="level" value="B"> B
                <br>
                <input type="checkbox" name="level" value="C"> C
                <br>
                <input type="checkbox" name="level" value="D"> D
                <br>
            </td>
            <td>
                <input type="checkbox" name="action" value="All" checked> All actions
                <br>
                <input type="checkbox" name="action" value="Chats"> Chats
                <br>
                <input type="checkbox" name="action" value="Calculations"> Calculations
                <br>
                <input type="checkbox" name="action" value="RChanges"> Resistor Changes
                <br>
            </td>
        </tr>
    </table>
    <input type="submit" action="parseCSV()">
</form>

<div id="divTest"></div>


<p id="demo"></p>

<script>
    var team = function() {};
    var level = function() {};
    var member = function() {};
    var rChange = function() {};
    var message = function() {};
    var action = function() {};
    var teams = [];

    function loadFile(file) {
        if (typeof(FileReader) != "undefined") {
            var reader = new FileReader();
            reader.onerror = function(err) {
                console.log(err);
            }
            reader.onloadend = function(e) {
                $("#divTest").text("File has been loaded.");
                console.log("file loaded");
            }
            parseCSV(e);
        }

        function parseCSV(theForm) {
            var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.csv)$/;
            if (regex.test(fileInput.value)) {
                if (typeof(FileReader) != "undefined") {
                    var reader = new FileReader();
                    reader.onerror = function(err) {
                        console.log(err);
                    }
                    reader.onloadend = function(e) {
                        var obj = Papa.parse(e.target.result);
                        console.log("data parsed");
                        rowObjs = arrayToObjects(obj.data);
                        console.log("row objects created");
                        teams = makeTeams(rowObjs);
                        console.log("teams generated");
                        changes = analyze(rowObjs);
                        console.log("analysis complete");
                        reportResults(teams, theForm);
                    }
                    reader.readAsText(fileInput.files[0]);
                } else {
                    alert("This browser does not support HTML5.");
                }
            } else {
                alert("Please upload a valid CSV file.");
            }
        }
</script>
